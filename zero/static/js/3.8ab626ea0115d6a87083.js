webpackJsonp([3],{"134P":function(e,t,a){var n=a("pQzM");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);a("rjj0")("6ce56714",n,!0)},LjFA:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("pFYg"),r=a.n(n),o=a("mvHQ"),l=a.n(o),s=a("vwbq"),c=a("vLgD");var i={name:"dialog",data:function(){return{visible:this.show}},props:{title:"title",show:{type:Boolean,default:!1}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:"title",visible:e.show},on:{"update:visible":function(t){e.show=t}}},[a("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)},staticRenderFns:[]},u=(a("VU/8")(i,d,!1,null,null,null).exports,{name:"hydraulic",components:{},props:{},data:function(){return{keys:["diatitle","show","input","width","height","zoom","attr","svg","g","node","link","selectcontaint","idnum","pump","valve","relationship","addnodeselected","addlinkselected","addpumpselected","addvalveselected","arrow","transformxy","brush","shiftKey","selected","graphdatachanged","graph","polygon","attrname","tmpattr"],diatitle:"",show:!1,input:["u","5"],width:1200,height:560,zoom:null,attr:null,svg:null,g:null,node:null,link:null,selectcontaint:{node:[],link:[],valve:[],pump:[],arrow:[]},idnum:1e4,pump:null,valve:null,relationship:{},addnodeselected:!1,addlinkselected:!1,addpumpselected:!1,addvalveselected:!1,arrow:null,transformxy:{x:0,y:0,k:1},brush:null,shiftKey:!1,selected:{nodes:[],links:[]},graphdatachanged:1,graph:{valve:[],pump:[],arrow:[],nodes:[{id:1,x:444,y:275},{id:2,x:378,y:324},{id:3,x:478,y:278}],links:[{id:4,source:1,target:0,block:"pump"},{id:5,source:0,target:2,block:"link"}]},polygon:{pump:[[0,5],[5*Math.tan(Math.PI/3),0],[0,-5]],valve:[[0,0],[5,5*Math.tan(Math.PI/6)],[5,-5*Math.tan(Math.PI/6)],[-5,5*Math.tan(Math.PI/6)],[-5,-5*Math.tan(Math.PI/6)]],arrow:[[-8,4*Math.tan(Math.PI/12)],[-4,0],[-8,-4*Math.tan(Math.PI/12)]]},attrname:{valve:[{name:"ID",value:1e6},{name:"名称",value:"调节阀"},{name:"压降",value:.1},{name:"流量",value:.1}],pump:[{name:"ID",value:2e6},{name:"名称",value:"水泵"},{name:"扬程",value:.1},{name:"流量",value:.1}],arrow:[],nodes:[{name:"ID",value:3e6},{name:"名称",value:"节点"},{name:"压力",value:.1}],links:[{name:"ID",value:4e6},{name:"名称",value:"管道"},{name:"deH",value:.1},{name:"s",value:.1},{name:"x",value:.1},{name:"DN",value:200},{name:"Din",value:200},{name:"v",value:.1},{name:"G",value:.1},{name:"lenth",value:25},{name:"theta",value:1.3},{name:"pump",value:0},{name:"type",value:"管道"}]},tmpattr:[{name:"ID",value:4e6},{name:"名称",value:"管道"},{name:"deH",value:.1},{name:"s",value:.1},{name:"x",value:.1},{name:"DN",value:200},{name:"Din",value:200},{name:"v",value:.1},{name:"G",value:.1}]}},created:function(){var e=this;window.addEventListener("beforeunload",function(){localStorage.setItem("hydraulic",l()(e.savedatatolocal()))})},mounted:function(){var e=this,t=(s.zoomIdentity,s.randomNormal(e.width/2,80)),a=s.randomNormal(e.height/2,80);s.range(200).map(function(){return[t(),a()]});for(var n in s.select("body").attr("tabindex",1).on("keydown.brush",e.keyflip).on("keyup.brush",e.keyflip).each(function(){this.focus()}),e.g=s.select("#panel").append("svg").attr("float","left").attr("width",e.width).attr("height",e.height).attr("id","back").append("g").attr("id","face").attr("width",e.width).attr("height",e.height),e.link=e.g.append("g").attr("class","link").attr("id","link").selectAll("line"),e.valve=e.g.append("g").attr("class","valve").attr("id","valve").selectAll("polygon"),e.arrow=e.g.append("g").attr("class","arrow").attr("id","arrow").selectAll("polygon"),e.pump=e.g.append("g").attr("class","pump").attr("id","pump").selectAll("polygon"),e.brush=e.g.append("g").attr("class","brush"),e.node=e.g.append("g").attr("class","node").attr("id","node").selectAll("circle"),e.attr=s.select("#attr").append("div").attr("class","attr").attr("id","attr1").selectAll("input"),e.graph.nodes.forEach(function(e){e.selected=!1,e.previouslySelected=!1,e.attr=[]}),e.graph.links.forEach(function(t){t.source=e.graph.nodes[t.source],t.target=e.graph.nodes[t.target],t.attr=[];var a=Math.atan2(t.target.y-t.source.y,t.target.x-t.source.x),n=(t.source.x+t.target.x)/2,r=(t.source.y+t.target.y)/2;e.graph.arrow.push({id:e.idcreator(),path:e.drawpolygon([t.target.x,t.target.y],a,e.polygon.arrow),source:t.source,target:t.target,fatherlink:t.id});var o=e.idcreator();"pump"==t.block&&e.graph.pump.push({id:o,path:e.drawpolygon([n,r],a,e.polygon.pump),source:t.source,target:t.target,fatherlink:t.id,attr:[{name:"ID",value:o},{name:"名称",value:"水泵"},{name:"扬程",value:0},{name:"流量",value:0}]}),t.blockid=o;var l=e.idcreator();"valve"==t.block&&e.graph.valve.push({id:l,path:e.drawpolygon([n,r],a,e.polygon.valve),source:t.source,target:t.target,fatherlink:t.id,attr:[{name:"ID",value:l},{name:"名称",value:"调节阀"},{name:"压降",value:0},{name:"流量",value:0}]}),t.blockid=l,void 0==e.relationship[t.source.id]?(e.relationship[t.source.id]={father:[],son:[]},e.relationship[t.source.id].son.push(t.target.id)):e.relationship[t.source.id].son.push(t.target.id),void 0==e.relationship[t.target.id]?(e.relationship[t.target.id]={father:[],son:[]},e.relationship[t.target.id].father.push(t.source.id)):e.relationship[t.target.id].father.push(t.source.id)}),e.graph.pump.forEach(function(e){e.selected=!1,e.previouslySelected=!1,e.attr=[]}),e.graph.valve.forEach(function(e){e.selected=!1,e.previouslySelected=!1,e.attr=[]}),e.graph.arrow.forEach(function(e){e.attr=[]}),e.arrow=e.arrow.data(e.graph.arrow).enter().append("polygon").attr("stroke","black").attr("class","line").attr("points",function(e){return e.path}),e.pump=e.pump.data(e.graph.pump).enter().append("polygon").attr("stroke","black").attr("fill","blue").attr("class","line").attr("points",function(e){return e.path}).on("mousedown",function(t){e.showattr(t.attr),t.selected=!t.selected,t.selected&&e.selectcontaint.pump.push(t.id)||e.removebyval(e.selectcontaint.pump,t.id),t.selected&&s.select(this).attr("stroke","red")||s.select(this).attr("stroke","black")}),e.valve=e.valve.data(e.graph.valve).enter().append("polygon").attr("stroke","black").attr("fill","green").attr("class","line").attr("points",function(e){return e.path}).on("mousedown",function(t){e.showattr(t.attr),t.selected=!t.selected,t.selected&&e.selectcontaint.valve.push(t.id)||e.removebyval(e.selectcontaint.valve,t.id),t.selected&&s.select(this).attr("stroke","red")||s.select(this).attr("stroke","black")}),e.link=e.link.data(e.graph.links).enter().append("line").attr("stroke","black").attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}).on("mousedown",function(t){e.showattr(t.attr),t.selected=!t.selected,t.selected&&e.selectcontaint.link.push(t.id)||e.removebyval(e.selectcontaint.link,t.id),t.selected&&s.select(this).attr("stroke","red")||s.select(this).attr("stroke","black")}),e.node=e.node.data(e.graph.nodes).enter().append("circle").attr("r",2).attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).on("mousedown",function(t){e.showattr(t.attr),t.selected=!t.selected,t.selected&&e.selectcontaint.node.push(t.id)||e.removebyval(e.selectcontaint.node,t.id),t.selected&&s.select(this).attr("stroke","red")||s.select(this).attr("stroke","black")}).call(s.drag().on("drag",function(t){var a,n,r,o,l;t.x=s.event.x,t.y=s.event.y,s.select(this).attr("cx",t.x).attr("cy",t.y),e.link.filter(function(e){return e.source===t}).attr("x1",t.x).attr("y1",t.y),e.link.filter(function(e){return e.target===t}).attr("x2",t.x).attr("y2",t.y),e.pump.filter(function(o){return o.source===t&&(a=Math.atan2(o.target.y-t.y,o.target.x-t.x),n=(t.x+o.target.x)/2,r=(t.y+o.target.y)/2,o.path=e.drawpolygon([n,r],a,e.polygon.pump),!0)}),e.pump.filter(function(o){return o.target===t&&(a=Math.atan2(t.y-o.source.y,t.x-o.source.x),n=(o.source.x+t.x)/2,r=(o.source.y+t.y)/2,o.path=e.drawpolygon([n,r],a,e.polygon.pump),!0)}),e.pump.data(e.graph.pump).attr("points",function(e){return e.path}),e.valve.filter(function(o){return o.source===t&&(a=Math.atan2(o.target.y-t.y,o.target.x-t.x),n=(t.x+o.target.x)/2,r=(t.y+o.target.y)/2,o.path=e.drawpolygon([n,r],a,e.polygon.valve),!0)}),e.valve.filter(function(o){return o.target===t&&(a=Math.atan2(t.y-o.source.y,t.x-o.source.x),n=(o.source.x+t.x)/2,r=(o.source.y+t.y)/2,o.path=e.drawpolygon([n,r],a,e.polygon.valve),!0)}),e.valve.data(e.graph.valve).attr("points",function(e){return e.path}),e.arrow.filter(function(n){return n.source===t&&(a=Math.atan2(n.target.y-t.y,n.target.x-t.x),o=n.target.x,l=n.target.y,n.path=e.drawpolygon([o,l],a,e.polygon.arrow),!0)}),e.arrow.filter(function(n){return n.target===t&&(a=Math.atan2(t.y-n.source.y,t.x-n.source.x),o=t.x,l=t.y,n.path=e.drawpolygon([o,l],a,e.polygon.arrow),!0)}),e.arrow.data(e.graph.arrow).attr("points",function(e){return e.path})})),e.graph)e.graph.hasOwnProperty(n)&&e.graph[n].length>=1&&e.attrname[n].length>=1&&e.graph[n].forEach(function(t){"undefind"==typeof t.attr&&(t.attr=[]),e.attrname[n].forEach(function(e){t.attr.push({name:e.name,value:"ID"==e.name&&t.id||e.value})})});if(e.svg=s.select("#back").call(s.zoom().scaleExtent([1,8]).on("zoom",e.zoomed)),localStorage.getItem("hydraulic")){var r=JSON.parse(localStorage.getItem("hydraulic"));e.graph=e.jsontomodel(r),e.renewrelation(),e.redrawlinks(),e.redrawnode(),e.renewid()}},watch:{addlinkselected:function(e){this.$refs.addlink.style.background=this.addlinkselected?"red":"gray";var t=this;t.addlinkselected?(t.selectcontaint.node=[],t.node.filter(function(e){return e.selected&&(e.selected=!1),e.selected&&s.select(this).attr("stroke","red")||s.select(this).attr("stroke","black"),!0}),s.select("#back").on("click",function(e){if(console.log("addlink listen click"),t.selectcontaint.node.length>=2){var a,n,r,o,l=999;switch(a=t.searchindexbyid(t.selectcontaint.node[0],t.graph.nodes),n=t.searchindexbyid(t.selectcontaint.node[1],t.graph.nodes),r=t.graph.nodes[a],o=t.graph.nodes[n],void 0!==t.relationship[r.id]&&(t.relationship[r.id].son.forEach(function(e){e==o.id&&(l=1)}),t.relationship[r.id].father.forEach(function(e){e==o.id&&(l=2)})),l){case 1:t.selectcontaint.node=[],t.node.filter(function(e){return e.selected&&(e.selected=!1),e.selected&&s.select(this).attr("stroke","red")||s.select(this).attr("stroke","black"),!0});break;case 2:t.graph.links.forEach(function(e){e.source==o&&e.target==r&&(e.source=r,e.target=o)}),t.graph.pump.forEach(function(e){if(e.source==o&&e.target==r){e.source=r,e.target=o;var a=Math.atan2(o.y-r.y,o.x-r.x),n=(r.x+o.x)/2,l=(r.y+o.y)/2;e.path=t.drawpolygon([n,l],a,t.polygon.pump)}}),t.graph.valve.forEach(function(e){e.source==o&&e.target==r&&(e.source=r,e.target=o)});var c=Math.atan2(o.y-r.y,o.x-r.x);t.graph.arrow.forEach(function(e){e.source==o&&e.target==r&&(e.source=r,e.target=o,e.path=t.drawpolygon([o.x,o.y],c,t.polygon.arrow))}),t.removebyval(t.relationship[r.id].father,o.id),t.relationship[r.id].son.push(o.id),t.removebyval(t.relationship[o.id].son,r.id),t.relationship[o.id].father.push(r.id),t.redrawlinks(),t.selectcontaint.node=[],t.node.filter(function(e){return e.selected&&(e.selected=!1),e.selected&&s.select(this).attr("stroke","red")||s.select(this).attr("stroke","black"),!0});break;default:var i=t.idcreator();t.graph.links.push({id:i,source:r,target:o,selected:!1,previouslySelected:!1,block:"link",attr:[{name:"ID",value:i},{name:"名称",value:"管道"},{name:"deH",value:0},{name:"s",value:0},{name:"x",value:0},{name:"DN",value:350},{name:"Din",value:350},{name:"v",value:0},{name:"G",value:0},{name:"lenth",value:25},{name:"theta",value:1.3},{name:"pump",value:0},{name:"type",value:"管道"}]}),void 0==t.relationship[r.id]?(t.relationship[r.id]={father:[],son:[]},t.relationship[r.id].son.push(o.id)):t.relationship[r.id].son.push(o.id),void 0==t.relationship[o.id]?(t.relationship[o.id]={father:[],son:[]},t.relationship[o.id].father.push(r.id)):t.relationship[o.id].father.push(r.id);c=Math.atan2(o.y-r.y,o.x-r.x),r.x,o.x,r.y,o.y;t.graph.arrow.push({id:t.idcreator(),path:t.drawpolygon([o.x,o.y],c,t.polygon.arrow),source:r,target:o,fatherlink:i}),t.redrawlinks(),t.selectcontaint.node=[],t.node.filter(function(e){return e.selected&&(e.selected=!1),e.selected&&s.select(this).attr("stroke","red")||s.select(this).attr("stroke","black"),!0})}}})):t.addnodeselected||t.addpumpselected||t.addvalveselected||(s.select("#back").on("click",null),console.log("back s click listen killed by addlink"))},addvalveselected:function(e){this.$refs.addvalve.style.background=this.addvalveselected?"red":"gray";var t=this;t.addvalveselected?(t.selectcontaint.link=[],t.link.filter(function(e){return e.selected&&(e.selected=!1),e.selected&&s.select(this).attr("stroke","red")||s.select(this).attr("stroke","black"),!0}),s.select("#back").on("click",function(e){if(console.log("valve listen clicked"),t.selectcontaint.link.length>=1){var a=t.selectcontaint.link[0];t.link.filter(function(e){if(e.id==a){if("link"==e.block){var n=Math.atan2(e.target.y-e.source.y,e.target.x-e.source.x),r=(e.source.x+e.target.x)/2,o=(e.source.y+e.target.y)/2,l=t.idcreator();t.graph.valve.push({id:l,path:t.drawpolygon([r,o],n,t.polygon.valve),source:e.source,target:e.target,selected:!1,fatherlink:e.id,attr:[{name:"ID",value:l},{name:"名称",value:"调节阀"},{name:"压降",value:0},{name:"流量",value:0}]}),e.block="valve",e.blockid=l,t.valve=s.select("#valve").selectAll("polygon").remove(),t.valve=s.select("#valve").selectAll("polygon"),t.valve=t.valve.data(t.graph.valve).enter().append("polygon").attr("stroke","black").attr("fill","green").attr("class","line").attr("points",function(e){return e.path}).on("mousedown",function(e){t.showattr(e.attr),e.selected=!e.selected,e.selected&&t.selectcontaint.valve.push(e.id)||t.removebyval(t.selectcontaint.valve,e.id),e.selected&&s.select(this).attr("stroke","red")||s.select(this).attr("stroke","black")}),console.log("added a valve")}else console.log("管线上已经有设备，请删除后添加。");t.selectcontaint.link=[],t.link.filter(function(e){return e.selected&&(e.selected=!1),e.selected&&s.select(this).attr("stroke","red")||s.select(this).attr("stroke","black"),!0})}})}else;})):t.addnodeselected||t.addlinkselected||t.addpumpselected||s.select("#back").on("click",null)},addpumpselected:function(e){this.$refs.addpump.style.background=this.addpumpselected?"red":"gray";var t=this;t.addpumpselected?(t.selectcontaint.link=[],s.select("#back").on("click",function(e){if(t.selectcontaint.link.length>=1){var a=t.selectcontaint.link[0];t.link.filter(function(e){if(e.id==a){if("link"==e.block){var n=Math.atan2(e.target.y-e.source.y,e.target.x-e.source.x),r=(e.source.x+e.target.x)/2,o=(e.source.y+e.target.y)/2,l=t.idcreator();t.graph.pump.push({id:l,path:t.drawpolygon([r,o],n,t.polygon.pump),source:e.source,target:e.target,selected:!1,fatherlink:e.id,attr:[{name:"ID",value:l},{name:"名称",value:"水泵"},{name:"扬程",value:0},{name:"流量",value:0}]}),e.block="pump",e.blockid=l,t.pump=s.select("#pump").selectAll("polygon").remove(),t.pump=s.select("#pump").selectAll("polygon"),t.pump=t.pump.data(t.graph.pump).enter().append("polygon").attr("stroke","black").attr("fill","blue").attr("class","line").attr("points",function(e){return e.path}).on("mousedown",function(e){t.showattr(e.attr),e.selected=!e.selected,e.selected&&t.selectcontaint.pump.push(e.id)||t.removebyval(t.selectcontaint.pump,e.id),e.selected&&s.select(this).attr("stroke","red")||s.select(this).attr("stroke","black")}),console.log("added a pump")}else console.log("管线上已经有设备，请删除后添加。");t.selectcontaint.link=[],t.link.filter(function(e){return e.selected&&(e.selected=!1),e.selected&&s.select(this).attr("stroke","red")||s.select(this).attr("stroke","black"),!0})}})}else;})):t.addnodeselected||t.addlinkselected||t.addvalveselected||(s.select("#back").on("click",null),console.log("back s click listen killed by addlink"))},addnodeselected:function(e){this.$refs.addnode.style.background=this.addnodeselected?"red":"gray";var t,a,n,r,o,l=this;this.addnodeselected?s.select("#back").on("click",function(e){var c=s.mouse(this);t=c[0],a=c[1],n=l.transformxy.x,r=l.transformxy.y,o=l.transformxy.k;var i=l.idcreator();l.graph.nodes.push({id:i,x:(t-n)/o,y:(a-r)/o,selected:!1,previouslySelected:!1,attr:[{name:"ID",value:i},{name:"名称",value:"节点"},{name:"压力",value:0}]}),l.redrawnode(),console.log("added one node!"),console.log("mouse x y:"+(t-n)/o+","+(a-r)/o)}):l.addlinkselected||l.addpumpselected||l.addvalveselected||(s.select("#back").on("click",null),console.log("back s click listen killed by addnode"))}},computed:{elselected:function(){var e="节点ID：";return this.selectcontaint.node.forEach(function(t){e+=t,e+=","}),e+="管线ID：",this.selectcontaint.link.forEach(function(t){e+=t,e+=","}),e+="阀门ID：",this.selectcontaint.valve.forEach(function(t){e+=t,e+=","}),e+="泵ID：",this.selectcontaint.pump.forEach(function(t){e+=t,e+=","}),e},redraw:function(){return console.log("redawdown"),this.graphdatachanged}},methods:{unselectall:function(){var e=this;e.selectcontaint={node:[],link:[],valve:[],pump:[],arrow:[]},e.link.filter(function(t){1==t.selected&&(t.selected=!t.selected,t.selected&&e.selectcontaint.link.push(t.id)||e.removebyval(e.selectcontaint.link,t.id),t.selected&&s.select(this).attr("stroke","red")||s.select(this).attr("stroke","black"))}),e.node.filter(function(t){1==t.selected&&(t.selected=!t.selected,t.selected&&e.selectcontaint.node.push(t.id)||e.removebyval(e.selectcontaint.node,t.id),t.selected&&s.select(this).attr("stroke","red")||s.select(this).attr("stroke","black"))}),e.valve.filter(function(t){1==t.selected&&(t.selected=!t.selected,t.selected&&e.selectcontaint.valve.push(t.id)||e.removebyval(e.selectcontaint.valve,t.id),t.selected&&s.select(this).attr("stroke","red")||s.select(this).attr("stroke","black"))}),e.pump.filter(function(t){1==t.selected&&(t.selected=!t.selected,t.selected&&e.selectcontaint.pump.push(t.id)||e.removebyval(e.selectcontaint.pump,t.id),t.selected&&s.select(this).attr("stroke","red")||s.select(this).attr("stroke","black"))})},deepcopy:function(e,t){t=t||{};for(var a in e)"object"===r()(e[a])?(t[a]=e[a].constructor===Array?[]:{},this.deepcopy(e[a],t[a])):t[a]=e[a];return t},modeltojson:function(){var e={};for(var t in e=this.deepcopy(this.graph))"nodes"!=t&&e[t].length>=1&&e[t].forEach(function(e){e.source=e.source.id,e.target=e.target.id});return e},jsontomodel:function(e){var t={},a=this;for(var n in t=a.deepcopy(e))"nodes"!=n&&t[n].length>=1&&t[n].forEach(function(e){e.source=a.searchbyid(t.nodes,e.source),e.target=a.searchbyid(t.nodes,e.target)});return console.log("graphmodel is:"),console.log(t),t},renewid:function(){var e=-1;for(var t in this.graph)this.graph.hasOwnProperty(t)&&this.graph[t].length>=1&&this.graph[t].forEach(function(t){"undefind"!=typeof t.id&&t.id>e&&(e=t.id)});this.idnum=e+1,console.log("reset the idcreater!")},renewrelation:function(){var e=this;e.relationship={},e.graph.links.forEach(function(t){void 0==e.relationship[t.source.id]?(e.relationship[t.source.id]={father:[],son:[]},e.relationship[t.source.id].son.push(t.target.id)):e.relationship[t.source.id].son.push(t.target.id),void 0==e.relationship[t.target.id]?(e.relationship[t.target.id]={father:[],son:[]},e.relationship[t.target.id].father.push(t.source.id)):e.relationship[t.target.id].father.push(t.source.id)})},searchbyid:function(e,t){var a={};return e.constructor===Array?(e.forEach(function(e){void 0!==e.id&&e.id==t&&(a=e)}),a):null},rowClass:function(e,t){return e&&e.rowIndex%2==0?{"background-color":"#E0FFF3"}:{"background-color":"#CEE8D1"}},showattr:function(e){this.tmpattr=e},showdialog:function(){this.show=!0},savedatatolocal:function(){var e=this.modeltojson();return console.log("model saved to localstage!!"),e},saveData:function(){var e,t=this.modeltojson();(e=t,Object(c.a)({url:"/model/save",method:"get",params:{data:e}})).then(function(e){}),console.log("model saved!!")},getData:function(){var e,t=this;Object(c.a)({url:"/model/get",method:"get",params:{data:e}}).then(function(e){t.graph=t.jsontomodel(e.data),console.log("model get!!"),t.renewrelation(),t.redrawlinks(),t.redrawnode(),t.renewid(),console.log("new model redrawed!")})},fetchData:function(){var e=this;(function(e){return Object(c.a)({url:"/model/analisys",method:"get",params:{data:e}})})(e.modeltojson()).then(function(t){e.graph=e.jsontomodel(t.data),e.renewrelation(),e.redrawlinks(),e.redrawnode(),e.renewid(),console.log("model result get from server!")})},idcreator:function(){return this.idnum++},dr:function(){this.drawpoints([100,100],0,[[0,20],[20*Math.tan(Math.PI/3),0],[0,-20]])},rotation:function(e,t){var a,n;if("object"==(void 0===t?"undefined":r()(t))&&2==t.length){var o=t;a=o[0]*Math.cos(e)-o[1]*Math.sin(e),n=o[0]*Math.sin(e)+o[1]*Math.cos(e)}return[a,n]},movement:function(e,t){var a,n;if("object"==(void 0===e?"undefined":r()(e))&&2==e.length){var o=t,l=e;a=o[0]+l[0],n=o[1]+l[1]}return[a,n]},drawpolygon:function(e,t,a){for(var n="",r=[],o=a,l=0,s=o.length;l<s;l++)r=o[l],r=this.rotation(t,r),n+=(r=this.movement(e,r))[0]+","+r[1]+" ";return n},redrawlinks:function(){var e=this;e.link=s.select("#link").selectAll("line").remove(),e.link=s.select("#link").selectAll("line"),e.link=e.link.data(e.graph.links).enter().append("line").attr("stroke","black").attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}).on("mousedown",function(t){e.showattr(t.attr),t.selected=!t.selected,t.selected&&e.selectcontaint.link.push(t.id)||e.removebyval(e.selectcontaint.link,t.id),t.selected&&s.select(this).attr("stroke","red")||s.select(this).attr("stroke","black")}),e.arrow=s.select("#arrow").selectAll("polygon").remove(),e.arrow=s.select("#arrow").selectAll("polygon"),e.arrow=e.arrow.data(e.graph.arrow).enter().append("polygon").attr("stroke","black").attr("class","line").attr("points",function(e){return e.path}),e.pump=s.select("#pump").selectAll("polygon").remove(),e.pump=s.select("#pump").selectAll("polygon"),e.pump=e.pump.data(e.graph.pump).enter().append("polygon").attr("stroke","black").attr("fill","blue").attr("class","line").attr("points",function(e){return e.path}).on("mousedown",function(t){e.showattr(t.attr),t.selected=!t.selected,t.selected&&e.selectcontaint.pump.push(t.id)||e.removebyval(e.selectcontaint.pump,t.id),t.selected&&s.select(this).attr("stroke","red")||s.select(this).attr("stroke","black")}),e.valve=s.select("#valve").selectAll("polygon").remove(),e.valve=s.select("#valve").selectAll("polygon"),e.valve=e.valve.data(e.graph.valve).enter().append("polygon").attr("stroke","black").attr("fill","green").attr("class","line").attr("points",function(e){return e.path}).on("mousedown",function(t){e.showattr(t.attr),t.selected=!t.selected,t.selected&&e.selectcontaint.valve.push(t.id)||e.removebyval(e.selectcontaint.valve,t.id),t.selected&&s.select(this).attr("stroke","red")||s.select(this).attr("stroke","black")})},redrawnode:function(){var e=this;e.node=s.select("#node").selectAll("circle").remove(),e.node=s.select("#node").selectAll("circle"),e.node=e.node.data(e.graph.nodes).enter().append("circle").attr("r",2).attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).attr("stroke",function(e){return e.selected?"red":"black"}).on("mousedown",function(t){e.showattr(t.attr);t.selected=!t.selected,t.selected&&e.selectcontaint.node.push(t.id)||e.removebyval(e.selectcontaint.node,t.id),t.selected&&s.select(this).attr("stroke","red")||s.select(this).attr("stroke","black")}).call(s.drag().on("drag",function(t){var a,n,r,o,l;t.x=s.event.x,t.y=s.event.y,s.select(this).attr("cx",t.x).attr("cy",t.y),e.link.filter(function(e){return e.source===t}).attr("x1",t.x).attr("y1",t.y),e.link.filter(function(e){return e.target===t}).attr("x2",t.x).attr("y2",t.y),e.pump.filter(function(o){return o.source===t&&(a=Math.atan2(o.target.y-t.y,o.target.x-t.x),n=(t.x+o.target.x)/2,r=(t.y+o.target.y)/2,o.path=e.drawpolygon([n,r],a,e.polygon.pump),!0)}),e.pump.filter(function(o){return o.target===t&&(a=Math.atan2(t.y-o.source.y,t.x-o.source.x),n=(o.source.x+t.x)/2,r=(o.source.y+t.y)/2,o.path=e.drawpolygon([n,r],a,e.polygon.pump),!0)}),e.pump.data(e.graph.pump).attr("points",function(e){return e.path}),e.valve.filter(function(o){return o.source===t&&(a=Math.atan2(o.target.y-t.y,o.target.x-t.x),n=(t.x+o.target.x)/2,r=(t.y+o.target.y)/2,o.path=e.drawpolygon([n,r],a,e.polygon.valve),!0)}),e.valve.filter(function(o){return o.target===t&&(a=Math.atan2(t.y-o.source.y,t.x-o.source.x),n=(o.source.x+t.x)/2,r=(o.source.y+t.y)/2,o.path=e.drawpolygon([n,r],a,e.polygon.valve),!0)}),e.valve.data(e.graph.valve).attr("points",function(e){return e.path}),e.arrow.filter(function(n){return n.source===t&&(a=Math.atan2(n.target.y-t.y,n.target.x-t.x),o=n.target.x,l=n.target.y,n.path=e.drawpolygon([o,l],a,e.polygon.arrow),!0)}),e.arrow.filter(function(n){return n.target===t&&(a=Math.atan2(t.y-n.source.y,t.x-n.source.x),o=t.x,l=t.y,n.path=e.drawpolygon([o,l],a,e.polygon.arrow),!0)}),e.arrow.data(e.graph.arrow).attr("points",function(e){return e.path})})),console.log("nodes redrawed")},redrawline:function(){},redrawall:function(){},addlink:function(){this.addnodeselected=!1,this.addpumpselected=!1,this.addlinkselected=!this.addlinkselected},searchindexbyid:function(e,t){if("object"===(void 0===t?"undefined":r()(t)))for(var a=0;a<t.length;a++)if(t[a].id==e)return a},deselected:function(){var e=this;for(var t in console.log("arrow graph is "),e.selectcontaint)if(e.selectcontaint.hasOwnProperty(t)&&e.selectcontaint[t].length>=1){var a=[];e.selectcontaint[t].forEach(function(n){"pump"!=t&&"valve"!=t||e.graph.links.forEach(function(e){e.blockid&&e.blockid==n&&(e.block="link")});var r=[];e.graph.arrow.forEach(function(e){e.source.id!=n&&e.target.id!=n&&e.fatherlink!=n||(r.push(e.id),console.log("remove arrow id added "+e.id))}),r.forEach(function(t){e.removebyid(e.graph,t)}),r=[],e.graph.links.forEach(function(t){t.source.id!=n&&t.target.id!=n||(r.push(t.id),e.removebyval(e.selectcontaint.link,t.id),console.log("remove link id added "+t.id))}),r.forEach(function(t){e.removebyid(e.graph,t)}),r=[],e.graph.pump.forEach(function(t){t.source.id!=n&&t.target.id!=n&&t.fatherlink!=n||(r.push(t.id),e.removebyval(e.selectcontaint.pump,t.id))}),r.forEach(function(t){e.removebyid(e.graph,t)}),r=[],e.graph.valve.forEach(function(t){t.source.id!=n&&t.target.id!=n&&t.fatherlink!=n||(r.push(t.id),e.removebyval(e.selectcontaint.valve,t.id))}),r.forEach(function(t){e.removebyid(e.graph,t)}),a.push(n)}),a.forEach(function(a){e.removebyid(e.graph,a),e.removebyval(e.selectcontaint[t],a)}),a=[]}e.renewrelation(),e.redrawlinks(),e.redrawnode()},removebyid:function(e,t){var a=this;for(var n in e)e.hasOwnProperty(n)&&e[n].forEach(function(r){r.id==t&&a.removebyval(e[n],r)})},addvalve:function(){this.addlinkselected=!1,this.addnodeselected=!1,this.addpumpselected=!1,this.addvalveselected=!this.addvalveselected},addpump:function(){this.addlinkselected=!1,this.addnodeselected=!1,this.addvalveselected=!1,this.addpumpselected=!this.addpumpselected},addnode:function(){this.addlinkselected=!1,this.addpumpselected=!1,this.addvalveselected=!1,this.addnodeselected=!this.addnodeselected},zoomed:function(){this.g.attr("transform",s.event.transform),this.transformxy=s.event.transform},removebyval:function(e,t){for(var a=0;a<e.length;a++)if(e[a]==t){e.splice(a,1);break}},dragged:function(e){s.select(this).attr("cx",e.x=s.event.x).attr("cy",e.y=s.event.y)}},brushstarted:function(){"end"!==s.event.sourceEvent.type&&this.node.classed("selected",function(e,t){return e.selected=e.previouslySelected=t.shiftKey&&e.selected})},brushed:function(){if("end"!==s.event.sourceEvent.type){var e=s.event.selection;that.node.classed("selected",function(t){return t.selected=t.previouslySelected^(null!=e&&e[0][0]<=t.x&&t.x<e[1][0]&&e[0][1]<=t.y&&t.y<e[1][1])})}},brushended:function(){null!=s.event.selection&&s.select(this).call(s.event.target.move,null)},mousedowned:function(e){console.log("down!!!!"),this.shiftKey?(s.select(this).classed("selected",e.selected=!e.selected),s.event.stopImmediatePropagation()):e.selected||that.node.classed("selected",function(t){return t.selected=e===t})},nodedragged:function(e){e.x=s.event.x,e.y=s.event.y,s.select(this).attr("cx",e.x).attr("cy",e.y),console.log("cx:"+e.x),this.link.filter(function(t){return t.source===e}).attr("x1",e.x).attr("y1",e.y),this.link.filter(function(t){return t.target===e}).attr("x2",e.x).attr("y2",e.y)},keyflip:function(){this.shiftKey=s.event.shiftKey||s.event.metaKey,console.log("shiftkey:  "+this.shiftkey)}}),p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"dashboard"},[a("div",{staticClass:"toolbar"},[a("button",{ref:"addnode",on:{click:function(t){e.addnode()}}},[e._v("添加节点")]),e._v(" "),a("button",{ref:"addlink",on:{click:function(t){e.addlink()}}},[e._v("添加管线")]),e._v(" "),a("button",{ref:"addpump",on:{click:function(t){e.addpump()}}},[e._v("添加电泵")]),e._v(" "),a("button",{ref:"addvalve",on:{click:function(t){e.addvalve()}}},[e._v("添加阻件")]),e._v(" "),a("button",{on:{click:function(t){e.deselected()}}},[e._v("删除阻件")]),e._v(" "),a("button",{on:{click:function(t){e.fetchData()}}},[e._v("实时计算")]),e._v(" "),a("button",{on:{click:function(t){e.saveData()}}},[e._v("保存模型")]),e._v(" "),a("button",{on:{click:function(t){e.getData()}}},[e._v("获取模型")]),e._v(" "),a("button",{on:{click:function(t){e.unselectall()}}},[e._v("取消选择")]),e._v(" "),a("button",{on:{click:function(t){e.showdialog()}}},[e._v("显示属性")])]),e._v(" "),a("el-dialog",{attrs:{title:e.diatitle,visible:e.show},on:{"update:visible":function(t){e.show=t}}},[a("el-input",{model:{value:e.show,callback:function(t){e.show=t},expression:"show"}})],1),e._v(" "),a("div",{staticClass:"contnent"},[a("div",{ref:"backpanel",staticClass:"backsvg",attrs:{id:"panel"}}),e._v(" "),a("div",{ref:"backpanel2",staticClass:"backattr",attrs:{id:"attr"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tmpattr,"row-style":e.rowClass,height:"100%","header-cell-style":"background:#DCDED8"}},[a("el-table-column",{attrs:{align:"center",label:"属性名"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(" "+e._s(t.row.name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"数值"},scopedSlots:e._u([{key:"default",fn:function(t){return["ID"==t.row.name?[a("span",[e._v(" "+e._s(t.row.value))])]:["名称"==t.row.name||"type"==t.row.name?[a("el-input",{attrs:{size:"small"},model:{value:t.row.value,callback:function(a){e.$set(t.row,"value",a)},expression:"scope.row.value"}})]:[a("el-input",{attrs:{type:"number",step:"0.001",size:"small"},model:{value:t.row.value,callback:function(a){e.$set(t.row,"value",a)},expression:"scope.row.value"}})]]]}}])})],1)],1)]),e._v(" "),a("div",{staticClass:"inform"},[e._v("已选中的元素："+e._s(e.elselected)+" ")])],1)},staticRenderFns:[]};var h=a("VU/8")(u,p,!1,function(e){a("134P")},"data-v-460c36c2",null);t.default=h.exports},mvHQ:function(e,t,a){e.exports={default:a("qkKv"),__esModule:!0}},pQzM:function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,'\n.dashboard[data-v-460c36c2] {\n  margin: 1px;\n  width: 100%;\n  background: #fffff4;\n  height: 580px;\n  position: absolute;\n}\n.addnodebutn[data-v-460c36c2] {\n  background: "green";\n}\n.toolbar[data-v-460c36c2] {\n  width: 100%;\n  background: white;\n}\n.contnent[data-v-460c36c2] {\n  width: 100%;\n  background: white;\n}\n.backsvg[data-v-460c36c2] {\n  width: 70%;\n  background: white;\n  height: 560px;\n  float: left;\n}\n.backattr[data-v-460c36c2] {\n  width: 15%;\n  background: #7bfbd3;\n  height: 560px;\n  float: left;\n}\n.inform[data-v-460c36c2] {\n  margin: 1px;\n  width: 100%;\n  background: #dfe1e3;\n  height: 20px;\n  float: left;\n}\nbutton[data-v-460c36c2] {\n  padding: 10px 20px;\n}\n.node[data-v-460c36c2] {\n  stroke: #999;\n  stroke-width: 1.5px;\n}\n.node.selected[data-v-460c36c2] {\n  stroke: #ff5b51;\n}\n.link[data-v-460c36c2] {\n  stroke: #999;\n}\n',""])},qkKv:function(e,t,a){var n=a("FeBl"),r=n.JSON||(n.JSON={stringify:JSON.stringify});e.exports=function(e){return r.stringify.apply(r,arguments)}}});